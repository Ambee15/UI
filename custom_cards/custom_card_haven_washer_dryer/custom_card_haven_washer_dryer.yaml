---
custom_card_haven_washer_dryer:
  template:
    - "ulm_language_variables"
    - "ulm_translation_engine"
  variables:
    ulm_custom_card_washer_dryer_label_idle:
    ulm_custom_card_washer_dryer_label_running:
    ulm_custom_card_washer_dryer_label_configuring:
    ulm_custom_card_washer_dryer_power:
    ulm_custom_card_washer_dryer_remote_control:
    ulm_custom_card_washer_dryer_delayed_start:
    ulm_custom_card_washer_dryer_delayed_starttime:
    ulm_custom_card_washer_dryer_machine_state:
    ulm_custom_card_washer_dryer_job_state:
    ulm_custom_card_washer_dryer_job_dryer: false
    ulm_custom_card_washer_dryer_start_switch:
      action: "none"
    ulm_custom_card_washer_dryer_pause_switch:
      action: "none"
    ulm_custom_card_washer_dryer_stop_switch:
      action: "none"
  triggers_update: "all"
  show_icon: false
  show_label: false
  show_name: false
  show_state: false
  show_last_changed: false
  show_entity_picture: false
  styles:
    card:
      - border-radius: "var(--border-radius)"
      - box-shadow: "var(--box-shadow)"
      - padding: "12px"
    grid:
      - grid-template-areas: >
          [[[
            var rows = ["\'row1\'"];

            if (variables.ulm_custom_card_washer_dryer_job_state) {
              rows.push("\'row2\'");
            }

            if (variables.ulm_custom_card_washer_dryer_remote_control) {
              rows.push("\'row3\'");
            }

            if (variables.ulm_custom_card_washer_dryer_delayed_start
              && variables.ulm_custom_card_washer_dryer_delayed_starttime) {
              rows.push("\'row4\'");
            }

            return rows.join(" ");
          ]]]
      - grid-template-columns: "1fr"
      - grid-template-rows: "min-content"
      - row-gap: "0px"
    custom_fields:
      row2:
        - display: >
            [[[
              return (variables.ulm_custom_card_washer_dryer_job_state
                && variables.ulm_custom_card_washer_dryer_power
                && states[variables.ulm_custom_card_washer_dryer_power] !== undefined
                && states[variables.ulm_custom_card_washer_dryer_power].state === "on") ? "block" : "none";
            ]]]
      row3:
        - display: >
            [[[
              return (variables.ulm_custom_card_washer_dryer_power
                && states[variables.ulm_custom_card_washer_dryer_power] !== undefined
                && states[variables.ulm_custom_card_washer_dryer_power].state === "on"
                && variables.ulm_custom_card_washer_dryer_remote_control
                && states[variables.ulm_custom_card_washer_dryer_remote_control] !== undefined
                && String(states[variables.ulm_custom_card_washer_dryer_remote_control].state) === "true") ? "block" : "none";
            ]]]
      row4:
        - display: >
            [[[
              return (variables.ulm_custom_card_washer_dryer_power
                && states[variables.ulm_custom_card_washer_dryer_power] !== undefined
                && states[variables.ulm_custom_card_washer_dryer_power].state === "on"
                && variables.ulm_custom_card_washer_dryer_remote_control
                && states[variables.ulm_custom_card_washer_dryer_remote_control] !== undefined
                && String(states[variables.ulm_custom_card_washer_dryer_remote_control].state) === "true"
                && variables.ulm_custom_card_washer_dryer_delayed_start
                && states[variables.ulm_custom_card_washer_dryer_delayed_start] !== undefined
                && states[variables.ulm_custom_card_washer_dryer_delayed_start].state === "on"
                && variables.ulm_custom_card_washer_dryer_delayed_starttime) ? "block" : "none";
            ]]]
  custom_fields:
    row1:
      card:
        type: "custom:button-card"
        styles:
          card:
            - box-shadow: "none"
            - padding: "0px"
        template:
          - "icon_info"
          - "blue_on"
        tap_action:
          action: "more-info"
        entity: "[[[ return variables.ulm_custom_card_washer_dryer_power; ]]]"
        label: >
          [[[
            if (variables.ulm_custom_card_washer_dryer_power
              && states[variables.ulm_custom_card_washer_dryer_power] !== undefined
              && states[variables.ulm_custom_card_washer_dryer_power].state === "on") {
              if (variables.ulm_custom_card_washer_dryer_machine_state
                && states[variables.ulm_custom_card_washer_dryer_machine_state] !== undefined
                && (states[variables.ulm_custom_card_washer_dryer_machine_state].state === "run"
                  || states[variables.ulm_custom_card_washer_dryer_machine_state].state === "pause")) {
                if (variables.ulm_custom_card_washer_dryer_label_running) {
                  return variables.ulm_custom_card_washer_dryer_label_running;
                }
              } else {
                if (variables.ulm_custom_card_washer_dryer_remote_control
                  && states[variables.ulm_custom_card_washer_dryer_remote_control] !== undefined
                  && String(states[variables.ulm_custom_card_washer_dryer_remote_control].state) === "true"
                  && variables.ulm_custom_card_washer_dryer_delayed_start
                  && states[variables.ulm_custom_card_washer_dryer_delayed_start] !== undefined
                  && states[variables.ulm_custom_card_washer_dryer_delayed_start].state === "on") {
                  if (variables.ulm_custom_card_washer_dryer_label_configuring) {
                    return variables.ulm_custom_card_washer_dryer_label_configuring;
                  }
                } else {
                  if (variables.ulm_custom_card_washer_dryer_label_idle) {
                    return variables.ulm_custom_card_washer_dryer_label_idle;
                  }
                }
              }
            } else {
              if (variables.ulm_custom_card_washer_dryer_label_idle) {
                return variables.ulm_custom_card_washer_dryer_label_idle;
              }
            }

            var label = states[variables.ulm_custom_card_washer_dryer_power].state;

            if (variables.ulm_custom_card_washer_dryer_machine_state
              && states[variables.ulm_custom_card_washer_dryer_machine_state] !== undefined
              && states[variables.ulm_custom_card_washer_dryer_machine_state].state !== undefined) {
              label += " â€¢ " + states[variables.ulm_custom_card_washer_dryer_machine_state].state;
            }

            return label;
          ]]]
    row2:
      card:
        type: "custom:button-card"
        template: >
          [[[
            return variables.ulm_custom_card_washer_dryer_job_dryer
              && String(variables.ulm_custom_card_washer_dryer_job_dryer) === "true" ? "list_5_items" : "list_4_items";
          ]]]
        styles:
          card:
            - padding: "0px"
            - margin-top: "12px"
            - border-radius: "var(--border-radius)"
            - pointer-events: "none"
            - background-color: "rgba(var(--color-theme), 0.05)"
            - justify-items: "center"
          grid:
            - justify-items: "center"
          img_cell:
            - justify-items: "center"
          custom_fields:
            item5:
              - display: >
                  [[[
                    return (variables.ulm_custom_card_washer_dryer_job_dryer
                      && String(variables.ulm_custom_card_washer_dryer_job_dryer) === "true") ? "block" : "none";
                  ]]]
        custom_fields:
          item1:
            card:
              type: "custom:button-card"
              icon: "mdi:scale"
              template: "custom_card_haven_washer_dryer_state"
              entity: "[[[ return variables.ulm_custom_card_washer_dryer_job_state; ]]]"
              state:
                - value: "weightSensing"
                  styles:
                    icon:
                      - transform: "scale(1.2)"
                      - color: "black"
                    card:
                      - background-color: "white"
          item2:
            card:
              type: "custom:button-card"
              icon: "mdi:waves"
              template: "custom_card_haven_washer_dryer_state"
              entity: "[[[ return variables.ulm_custom_card_washer_dryer_job_state; ]]]"
              state:
                - value: "wash"
                  styles:
                    icon:
                      - transform: "scale(1.2)"
                      - color: "black"
                    card:
                      - background-color: "white"
          item3:
            card:
              type: "custom:button-card"
              icon: "mdi:water"
              template: "custom_card_haven_washer_dryer_state"
              entity: "[[[ return variables.ulm_custom_card_washer_dryer_job_state; ]]]"
              state:
                - value: "rinse"
                  styles:
                    icon:
                      - transform: "scale(1.2)"
                      - color: "black"
                    card:
                      - background-color: "white"
          item4:
            card:
              type: "custom:button-card"
              icon: "mdi:fan"
              template: "custom_card_haven_washer_dryer_state"
              entity: "[[[ return variables.ulm_custom_card_washer_dryer_job_state; ]]]"
              state:
                - value: "spin"
                  styles:
                    icon:
                      - transform: "scale(1.2)"
                      - color: "black"
                    card:
                      - background-color: "white"
          item5:
            card:
              type: "custom:button-card"
              icon: "mdi:tumble-dryer"
              template: "custom_card_haven_washer_dryer_state"
              entity: "[[[ return variables.ulm_custom_card_washer_dryer_job_state ]]]"
              state:
                - value: "drying"
                  styles:
                    icon:
                      - transform: "scale(1.2)"
                      - color: "black"
                    card:
                      - background-color: "white"
    row3:
      card:
        type: "custom:button-card"
        template: >
          [[[
            return variables.ulm_custom_card_washer_dryer_delayed_start
              && variables.ulm_custom_card_washer_dryer_delayed_starttime ? "list_3_items" : "list_2_items";
          ]]]
        styles:
          card:
            - padding: "0px"
            - margin-top: "12px"
          custom_fields:
            item3:
              - display: >
                  [[[
                    return (variables.ulm_custom_card_washer_dryer_delayed_start
                      && variables.ulm_custom_card_washer_dryer_delayed_starttime) ? "block" : "none";
                  ]]]
        custom_fields:
          item1:
            card:
              type: "custom:button-card"
              template: "widget_icon"
              entity: "[[[ return variables.ulm_custom_card_washer_dryer_machine_state; ]]]"
              icon: "mdi:play"
              tap_action:
                action: >
                  [[[
                    if (states[variables.ulm_custom_card_washer_dryer_machine_state] !== undefined
                      && states[variables.ulm_custom_card_washer_dryer_machine_state].state === "run") {
                      return variables.ulm_custom_card_washer_dryer_pause_switch?.action ? variables.ulm_custom_card_washer_dryer_pause_switch.action : "none";
                    } else {
                      return variables.ulm_custom_card_washer_dryer_start_switch?.action ? variables.ulm_custom_card_washer_dryer_start_switch.action : "none";
                    }
                  ]]]
                entity: "[[[ return variables.ulm_custom_card_washer_dryer_start_switch.entity; ]]]"
                navigation_path: >
                  [[[
                    return (states[variables.ulm_custom_card_washer_dryer_machine_state] !== undefined
                      && states[variables.ulm_custom_card_washer_dryer_machine_state].state === "run")
                      ? variables.ulm_custom_card_washer_dryer_pause_switch?.navigation_path
                      : variables.ulm_custom_card_washer_dryer_start_switch?.navigation_path;
                  ]]]
                url_path: >
                  [[[
                    return (states[variables.ulm_custom_card_washer_dryer_machine_state] !== undefined
                      && states[variables.ulm_custom_card_washer_dryer_machine_state].state === "run")
                      ? variables.ulm_custom_card_washer_dryer_pause_switch?.url_path
                      : variables.ulm_custom_card_washer_dryer_start_switch?.url_path;
                  ]]]
                service: >
                  [[[
                    return (states[variables.ulm_custom_card_washer_dryer_machine_state] !== undefined
                      && states[variables.ulm_custom_card_washer_dryer_machine_state].state === "run")
                      ?  variables.ulm_custom_card_washer_dryer_pause_switch?.service
                      : variables.ulm_custom_card_washer_dryer_start_switch?.service;
                  ]]]
                service_data: >
                  [[[
                    return (states[variables.ulm_custom_card_washer_dryer_machine_state] !== undefined
                      && states[variables.ulm_custom_card_washer_dryer_machine_state].state === "run")
                      ? variables.ulm_custom_card_washer_dryer_pause_switch?.service_data
                      : variables.ulm_custom_card_washer_dryer_start_switch?.service_data;
                  ]]]
              state:
                - operator: "template"
                  value: >
                    [[[
                      return (states[variables.ulm_custom_card_washer_dryer_machine_state] !== undefined
                        && states[variables.ulm_custom_card_washer_dryer_machine_state].state === 'stop'
                        && (variables.ulm_custom_card_washer_dryer_start_switch === undefined
                          || variables.ulm_custom_card_washer_dryer_start_switch.action === undefined
                          || variables.ulm_custom_card_washer_dryer_start_switch.action === "none"));
                    ]]]
                  styles:
                    icon:
                      - color: "rgba(var(--color-theme),0.2)"
                - operator: "template"
                  value: >
                    [[[
                      return (states[variables.ulm_custom_card_washer_dryer_machine_state] !== undefined
                        && states[variables.ulm_custom_card_washer_dryer_machine_state].state === 'run'
                        && variables.ulm_custom_card_washer_dryer_pause_switch !== undefined
                        && variables.ulm_custom_card_washer_dryer_pause_switch.action !== undefined
                        && variables.ulm_custom_card_washer_dryer_pause_switch.action !== "none");
                    ]]]
                  icon: "mdi:pause"
                - operator: "template"
                  value: >
                    [[[
                      return (states[variables.ulm_custom_card_washer_dryer_machine_state] !== undefined
                        && states[variables.ulm_custom_card_washer_dryer_machine_state].state === 'run'
                        && (variables.ulm_custom_card_washer_dryer_pause_switch === undefined
                          || variables.ulm_custom_card_washer_dryer_pause_switch.action === undefined
                          || (variables.ulm_custom_card_washer_dryer_pause_switch !== undefined
                            && variables.ulm_custom_card_washer_dryer_pause_switch.action !== undefined
                            && variables.ulm_custom_card_washer_dryer_pause_switch.action === "none")));
                    ]]]
                  styles:
                    icon:
                      - color: "rgba(var(--color-theme),0.2)"
                  icon: "mdi:pause"
          item2:
            card:
              type: "custom:button-card"
              template: "widget_icon"
              entity: "[[[ return variables.ulm_custom_card_washer_dryer_machine_state ]]]"
              icon: "mdi:stop"
              tap_action:
                action: >
                  [[[
                    return (states[variables.ulm_custom_card_washer_dryer_machine_state] !== undefined
                      && states[variables.ulm_custom_card_washer_dryer_machine_state].state === "run"
                      && variables.ulm_custom_card_washer_dryer_stop_switch?.action) ? variables.ulm_custom_card_washer_dryer_stop_switch.action : "none";
                  ]]]
                entity: "[[[ return variables.ulm_custom_card_washer_dryer_stop_switch.entity; ]]]"
                navigation_path: "[[[ return variables.ulm_custom_card_washer_dryer_stop_switch.navigation_path; ]]]"
                url_path: "[[[ return variables.ulm_custom_card_washer_dryer_stop_switch.url_path; ]]]"
                service: "[[[ return variables.ulm_custom_card_washer_dryer_stop_switch.service; ]]]"
                service_data: "[[[ return variables.ulm_custom_card_washer_dryer_stop_switch.service_data; ]]]"
              state:
                - operator: "template"
                  value: >
                    [[[
                      return ((variables.ulm_custom_card_washer_dryer_machine_state !== undefined
                          && states[variables.ulm_custom_card_washer_dryer_machine_state] !== undefined
                          && states[variables.ulm_custom_card_washer_dryer_machine_state].state === 'stop')
                        || variables.ulm_custom_card_washer_dryer_stop_switch === undefined
                        || variables.ulm_custom_card_washer_dryer_stop_switch.action === undefined
                        || (variables.ulm_custom_card_washer_dryer_stop_switch !== undefined
                          && variables.ulm_custom_card_washer_dryer_stop_switch.action !== undefined
                          && variables.ulm_custom_card_washer_dryer_stop_switch.action === "none"));
                    ]]]
                  styles:
                    icon:
                      - color: "rgba(var(--color-theme),0.2)"
          item3:
            card:
              type: "custom:button-card"
              template:
                - "widget_icon"
                - "green_on"
              entity: "[[[ return variables.ulm_custom_card_washer_dryer_delayed_start; ]]]"
    row4:
      card:
        type: "custom:button-card"
        styles:
          card:
            - padding: "0px"
            - margin-top: "12px"
        template: "list_3_items"
        custom_fields:
          item1:
            card:
              type: "custom:button-card"
              template: "widget_icon"
              tap_action:
                action: "call-service"
                service: "input_datetime.set_datetime"
                service_data:
                  entity_id: "[[[ return variables.ulm_custom_card_washer_dryer_delayed_starttime; ]]]"
                  time: >
                    [[[
                      if (variables.ulm_custom_card_washer_dryer_delayed_starttime
                        && states[variables.ulm_custom_card_washer_dryer_delayed_starttime] !== undefined
                        && states[variables.ulm_custom_card_washer_dryer_delayed_starttime].attributes !== undefined
                        && states[variables.ulm_custom_card_washer_dryer_delayed_starttime].attributes.timestamp !== undefined) {
                        var timestamp = states[variables.ulm_custom_card_washer_dryer_delayed_starttime].attributes.timestamp

                        let unix_timestamp = timestamp - 4500;
                        // Create a new JavaScript Date object based on the timestamp
                        // multiplied by 1000 so that the argument is in milliseconds, not seconds.
                        var date = new Date(unix_timestamp * 1000);
                        // Hours part from the timestamp
                        var hours = date.getHours();
                        // Minutes part from the timestamp
                        var minutes = "0" + date.getMinutes();
                        // Seconds part from the timestamp
                        var seconds = "0" + date.getSeconds();
                        // Will display time in 10:30:23 format
                        return hours + ":" + minutes.substr(-2) + ":" + seconds.substr(-2);
                      } else {
                        return "00:00:00";
                      }
                    ]]]
              icon: "mdi:arrow-down"
          item2:
            card:
              type: "custom:button-card"
              template: "custom_card_haven_washer_dryer_delayed_text"
              entity: "[[[ return variables.ulm_custom_card_washer_dryer_delayed_starttime; ]]]"
              tap_action:
                action: "call-service"
                service: "input_datetime.set_datetime"
                service_data:
                  entity_id: "[[[ return variables.ulm_custom_card_washer_dryer_delayed_starttime; ]]]"
                  time: >
                    [[[
                      if (variables.ulm_custom_card_washer_dryer_delayed_starttime
                        && states[variables.ulm_custom_card_washer_dryer_delayed_starttime] !== undefined
                        && states[variables.ulm_custom_card_washer_dryer_delayed_starttime].attributes !== undefined
                        && states[variables.ulm_custom_card_washer_dryer_delayed_starttime].attributes.timestamp !== undefined) {
                        var timestamp = states[variables.ulm_custom_card_washer_dryer_delayed_starttime].attributes.timestamp

                        let unix_timestamp = timestamp - 3540;
                        // Create a new JavaScript Date object based on the timestamp
                        // multiplied by 1000 so that the argument is in milliseconds, not seconds.
                        var date = new Date(unix_timestamp * 1000);
                        // Hours part from the timestamp
                        var hours = date.getHours();
                        // Minutes part from the timestamp
                        var minutes = "0" + date.getMinutes();
                        // Seconds part from the timestamp
                        var seconds = "0" + date.getSeconds();
                        // Will display time in 10:30:23 format
                        return  hours + ":" + minutes.substr(-2) + ":" + seconds.substr(-2);
                      } else {
                        return "00:00:00";
                      }
                    ]]]
              hold_action:
                action: "call-service"
                service: "input_datetime.set_datetime"
                service_data:
                  entity_id: "[[[ variables.ulm_custom_card_washer_dryer_delayed_starttime ]]]"
                  time: >
                    [[[
                      if (variables.ulm_custom_card_washer_dryer_delayed_starttime
                        && states[variables.ulm_custom_card_washer_dryer_delayed_starttime] !== undefined
                        && states[variables.ulm_custom_card_washer_dryer_delayed_starttime].attributes !== undefined
                        && states[variables.ulm_custom_card_washer_dryer_delayed_starttime].attributes.timestamp !== undefined) {
                        var timestamp = states[variables.ulm_custom_card_washer_dryer_delayed_starttime].attributes.timestamp

                        let unix_timestamp = timestamp - 3660;
                        // Create a new JavaScript Date object based on the timestamp
                        // multiplied by 1000 so that the argument is in milliseconds, not seconds.
                        var date = new Date(unix_timestamp * 1000);
                        // Hours part from the timestamp
                        var hours = date.getHours();
                        // Minutes part from the timestamp
                        var minutes = "0" + date.getMinutes();
                        // Seconds part from the timestamp
                        var seconds = "0" + date.getSeconds();
                        // Will display time in 10:30:23 format
                        return hours + ":" + minutes.substr(-2) + ":" + seconds.substr(-2);
                      } else {
                        return "00:00:00";
                      }
                    ]]]
          item3:
            card:
              type: "custom:button-card"
              template: "widget_icon"
              tap_action:
                action: "call-service"
                service: "input_datetime.set_datetime"
                service_data:
                  entity_id: "[[[ return variables.ulm_custom_card_washer_dryer_delayed_starttime ]]]"
                  time: >
                    [[[
                      if (variables.ulm_custom_card_washer_dryer_delayed_starttime
                        && states[variables.ulm_custom_card_washer_dryer_delayed_starttime] !== undefined
                        && states[variables.ulm_custom_card_washer_dryer_delayed_starttime].attributes !== undefined
                        && states[variables.ulm_custom_card_washer_dryer_delayed_starttime].attributes.timestamp !== undefined) {
                        var timestamp = states[variables.ulm_custom_card_washer_dryer_delayed_starttime].attributes.timestamp
                        let unix_timestamp = timestamp - 2700;
                        var date = new Date(unix_timestamp * 1000);
                        var hours = date.getHours();
                        var minutes = "0" + date.getMinutes();
                        var seconds = "0" + date.getSeconds();
                        return hours + ":" + minutes.substr(-2) + ":" + seconds.substr(-2);
                      } else {
                        return "00:00:00";
                      }
                    ]]]
              icon: "mdi:arrow-up"

custom_card_haven_washer_dryer_state:
  show_icon: true
  show_name: false
  size: "20px"
  tap_action:
    action: "none"
  styles:
    card:
      - box-shadow: "none"
      - padding: "0px"
      - border-radius: "50%"
      - place-self: "center"
      - height: "42px"
      - width: "42px"
      - pointer-events: "auto"
      - background-color: "transparent"
    grid:
      - grid-template-areas: "'i'"
    icon:
      - color: "var(--google-grey)"

custom_card_haven_washer_dryer_delayed_text:
  tap_action:
    action: "toggle"
  template:
    - "ulm_translation_engine"
  show_icon: false
  show_label: true
  show_name: false
  label: "[[[ return variables.ulm_translation_state_unit ]]]"
  styles:
    grid:
      - grid-template-areas: "'l'"
    card:
      - box-shadow: "none"
      - padding: "0px"
      - background-color: "rgba(var(--color-theme),0.05)"
      - border-radius: "14px"
      - place-self: "center"
      - height: "42px"
    state:
      - color: "rgba(var(--color-theme),0.9)"
  size: "20px"
  color: "var(--google-grey)"

### List 5 Items ###
list_5_items:
  styles:
    grid:
      - grid-template-areas: "'item1 item2 item3 item4 item5'"
      - grid-template-columns: "1fr 1fr 1fr 1fr 1fr"
      - grid-template-rows: "min-content"
      - column-gap: "7px"
    card:
      - box-shadow: "none"
      - padding: "0px"
